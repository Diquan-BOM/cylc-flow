<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>cylc - a workflow engine</title>
		<link rel="stylesheet" type="text/css" href="css/main.css">
        <script type="text/javascript">
"use strict";

// --- Progress

/**
 * Get the next release from a set of milestones. The next release is simply the milestone with
 * a title 'next-release'.
 *
 * @param milestones: array of milestone objects
 * @return the milestone titled 'next-release', or null if none found
 */
function getNextRelease(milestones) {
    return milestones.find(function(milestone) {
        return milestone.title === "next-release";
    });
}
/**
 * Populate progress elements in the DOM.
 *
 * @param openIssues: integer with the number of open issues
 * @param closedIssues: integer with the number of closed issues
 * @param title: the title of the next release
 * @param link: URL link to the next release
  */
function populateProgress(openIssues, closedIssues, title, link) {
    var workProgress = closedIssues * 100 / (openIssues + closedIssues);

    var milestoneVersion = document.getElementById("milestone-version");
    milestoneVersion.innerHTML = title;

    var milestoneURL = document.getElementById("milestone-url");
    milestoneURL.setAttribute('href', link);

    var progressBarInner = document.getElementById("progress-bar-inner");
    progressBarInner.style.width = workProgress + "%";

    var progress = document.getElementById("progress");
    progress.innerHTML = Math.floor(workProgress) + "%";

    var milestoneContainer = document.getElementById("milestone-container");
    milestoneContainer.style.opacity = "1";
    milestoneContainer.style.transition = ".7s ease-in";
}
/**
 * Retrieve the progress of the project.
 *
 * @param url: GitHub API project milestones URL
 * @return a Promise object that populates DOM elements, or returns the status text on error
 */
function retrieveProgress(url) {
    return new Promise(function (resolve, reject) {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", url);

        xhr.onload = function () {
            var milestones = JSON.parse(this.response);
            var nextRelease = getNextRelease(milestones);

            if (nextRelease) {
                var openIssues = nextRelease.open_issues;
                var closedIssues = nextRelease.closed_issues;
                var title = nextRelease.title;
                var link = nextRelease.html_url.replace('s/next%20release', '/' + nextRelease.number);
                populateProgress(openIssues, closedIssues, title, link);
            }
        };

        xhr.onerror = reject(xhr.statusText);
        xhr.send();
    });
}

// --- Releases

/**
 * Truncate text at desired limit of max words. The text is split by
 * white spaces. If the number of tokens produced is less than the
 * given limit, we use the lowest value to truncate. Will append
 * ellipsis if the text was truncated (i.e. words were discarded).
 *
 * @param text: text to be truncated
 * @param maxWords: integer defining the maximum number of words to be returned
 * @return truncated text, with ellipsis if words were discarded
 */
function truncate(text, maxWords) {
    var tokens = text.trim().split(" ");
    var limit = Math.min(tokens.length, maxWords) - 1;
    var truncated = tokens.slice(0, limit);
    if (limit < tokens.length) {
        truncated.push("...");
    }
    return truncated.join(" ");
}

/**
 * Create release HTML element to be added to the DOM.
 *
 * @param name: name of the release
 * @param link: link for the GitHub release
 * @param publishedAt: raw text date as returned from the API
 * @param body: the description of the release
 * @return a div HTML element with other elements within
 */
function createReleaseElement(name, link, publishedAt, body) {
    var div = document.createElement("div");

    var linkElement = document.createElement("a");
    linkElement.setAttribute("href", link);
    linkElement.innerHTML = name;

    var paragraph = document.createElement("p");
    paragraph.appendChild(linkElement);
    var d = new Date(publishedAt),
        month = '' + (d.getMonth() + 1),
        day = '' + d.getDate(),
        year = d.getFullYear();
    if (month.length < 2) month = '0' + month;
    if (day.length < 2) day = '0' + day;
    var formattedDate = [year, month, day].join('-');
    paragraph.insertAdjacentHTML("beforeend", ", " + formattedDate);
    div.appendChild(paragraph);

    var small = document.createElement("small");
    small.innerHTML = truncate(body, 15);
    div.appendChild(small);

    return div;
}

/**
 * Populate HTML elements with information about the latest release.
 *
 * @param name: name of the release
 * @param publishedAt: raw text date as returned from the API
 */
function populateLatestReleaseInformation(name, publishedAt) {

    var latestReleaseName = document.getElementById("latest-release-name");
    latestReleaseName.innerHTML = name;

    var latestReleaseDateTime = document.getElementById("latest-release-pubdate-time");
    latestReleaseDateTime.setAttribute("datetime", publishedAt);

    var latestReleaseDateText = document.getElementById("latest-release-pubdate-text");
    latestReleaseDateText.innerHTML = publishedAt;
}

/**
 * Retrieve the releases of the project.
 *
 * @param url: GitHub API project releases URL
 * @param linkBaseUrl: Base URL to create links to releases
 * @return a Promise object that populates and creates DOM elements, or returns the status text on error
 */
function retrieveReleases(url, linkBaseUrl) {
    var releasesContainer = document.getElementById("repository-releases");
    return new Promise(function(resolve, reject) {
        const xhr = new XMLHttpRequest();
        xhr.open("GET", url);
        xhr.onload = function() {
            const releases = JSON.parse(this.response);
            // we only want to iterate over 4 releases...
            var min = Math.min(releases.length, 4);
            releasesContainer.innerHTML = "";
            for (var i = 0; i < min; ++i) {
                var release = releases[i];
                var name = release.name;
                var publishedAt = release.published_at;
                var body = release.body;
                var link = linkBaseUrl + release.tag_name;
                var releaseElement = createReleaseElement(name, link, publishedAt, body);
                releasesContainer.appendChild(releaseElement);

                // we also display the latest release metadata
                if (i == 0) {
                    populateLatestReleaseInformation(name, publishedAt);
                }
            }
        };
        xhr.onerror = reject(xhr.statusText);
        xhr.send();
    });
}

// --- window.onload

/**
 * Called when the browser loads the page. It will execute two promises asynchronously,
 * one to retrieve the progress, and the other to retrieve the releases.
 * If an error occurs, it will print the error to the browser console.
 */
window.onload = function () {
    var milestonesUrl = "https://api.github.com/repos/cylc/cylc/milestones";
    var releasesUrl = "https://api.github.com/repos/cylc/cylc/releases";
    var releasesLinkBaseUrl = "https://github.com/cylc/cylc/releases/tag/";
    Promise.all([
        retrieveProgress(milestonesUrl),
        retrieveReleases(releasesUrl, releasesLinkBaseUrl)
    ])
    .then(function() {
        // all good here!
    })
    .catch(function(error) {
        console.log(error);
    });
};
</script>

	</head>
	<body>
<div id="header">
            <div class="page">
                <div class="container">
                    <div class="column">
                        <a href="index.html" id="logo_top">
                            <span style="color:#ff5966">c</span>
                            <span style="color:#eebb00">y</span>
                            <span style="color:#00c798">l</span>
                            <span style="color:#00b4fd">c</span>
                        </a>
                    </div>  <!--column-->
                    <div class="column">
                        <div id="nav">
                            <a href="features.html">Features</a>
                            <a href="screenshots.html">Screenshots</a>
                            <a href="documentation.html">Documentation</a>
                            <a href="support.html">Support</a>
                        </div>  <!--nav-->
                    </div>  <!--column-->
                </div>  <!--container-->
            </div>  <!--page-->
        </div>  <!--header-->

        <div id="wrapper">
            <div class="page">
                <div class="container">
                    <div class="column" id="main-content"><p><strong>Cylc (<em>“silk”</em>) is a workflow engine for cycling systems</strong> - it orchestrates
distributed <strong>suites</strong> of interdependent <strong>cycling tasks</strong> that may continue to
run indefinitely.</p>

<p>There are several reasons why tasks might need to be cycled:</p>

<ul>
  <li>
    <p>To run successive cycles of an environmental forecasting system (where in
real time operation new forecasts are initiated at regular intervals; but in
catch-up or historical mode dependencies may allow concurrent cycles).</p>
  </li>
  <li>
    <p>To split long model runs into a sequence of smaller runs, with associated
processing tasks for each chunk.</p>
  </li>
  <li>
    <p>To run successive steps in some multi-task iterative process, such as for
optimizing model parameters.</p>
  </li>
  <li>
    <p>To process a series of datasets (potentially concurrently, to the extent
possible) as they are generated or received.</p>
  </li>
</ul>

<p>Cylc was originally developed for operational environmental forecasting at
<a href="http://www.niwa.co.nz">NIWA</a> by <a href="mailto:hilary.oliver@niwa.co.nz">Dr Hilary
Oliver</a>. It is now an Open
Source collaboration involving NIWA, <a href="http://www.metoffice.gov.uk">Met Office</a>,
and
<a href="https://github.com/cylc/cylc/blob/master/CONTRIBUTING.md#code-contributors">others</a>.
It is <a href="./license.html">available under the GPL v3 license</a>.</p>

<div class="container" style="height:90px">
    <div class="column" style="float:left; width:20%; padding-top:1em; padding-left:3%;">
        <img src="img/workflow-icon.svg" height="70" />
    </div>
    <div class="column" style="float:right; width:76%">
        <p />
            Suites are defined in a human-readable config
file format - so you can use software development power tools for suite
development.
    </div>
</div>

<div class="container" style="height:90px">
    <div class="column" style="float:left; width:20%; padding-top:1em; padding-left:3%;">
        <img src="img/workflow-icon.svg" height="70" />
    </div>
    <div class="column" style="float:right; width:76%">
        <p />
            Configure scheduling with an efficient graph
description notation, and task runtime properties in an efficient inheritance
hierarchy (to factor out all commonality).
    </div>
</div>

<div class="container" style="height:90px">
    <div class="column" style="float:left; width:20%; padding-top:1em; padding-left:3%;">
        <img src="img/workflow-icon.svg" height="70" />
    </div>
    <div class="column" style="float:right; width:76%">
        <p />
            Cylc dynamically generates new workflow
without being constrained by a global cycle loop. Cycles interleave
naturally, suites flow around failed or delayed tasks, and they adapt to
insertion and removal of tasks.
    </div>
</div>

<div class="container" style="height:90px">
    <div class="column" style="float:left; width:20%; padding-top:1em; padding-left:3%;">
        <img src="img/workflow-icon.svg" height="70" />
    </div>
    <div class="column" style="float:right; width:76%">
        <p />
            Cylc has low admin overhead and a small
security footprint, because - as a distributed system - there is no central
server process to manage workflows for all users.
    </div>
</div>

<div class="container" style="height:90px">
    <div class="column" style="float:left; width:20%; padding-top:1em; padding-left:3%;">
        <img src="img/workflow-icon.svg" height="70" />
    </div>
    <div class="column" style="float:right; width:76%">
        <p />
            Plus <a href="features.html">many other
features</a> to support both clock-triggered real time and free-flow
metascheduling in research and operational environments.
    </div>
</div>

<p>Please <a href="mailto:hilary.oliver@niwa.co.nz">let us know</a> if your organization
should be included in the <strong><a href="./users.html">list of Cylc users</a></strong>.</p>

<p>Here’s the DOI to use when citing Cylc: <a href="https://zenodo.org/badge/latestdoi/1836229"><img src="https://zenodo.org/badge/1836229.svg" alt="DOI" /></a></p>

<p>See also <a href="./documentation.html#publications-and-citations">publications and citations</a></p>
</div>
                    <div class="column" style="width:300px;" ><div id="repository">
  <div> 
    <a href="http://www.niwa.co.nz"><img src="css/niwa-colour-small.png"></a>
    </div>
    <div style="margin-top:10px">
    <a href="http://www.metoffice.gov.uk"><img src="css/mo-logo-cut.jpg"></a>
    </div>
    <p>
    <a class="button" href="https://github.com/cylc/cylc/releases/latest">
        Download <span id="latest-release-name"></span><br />
        <small>Released <time id="latest-release-pubdate-time" datetime=""><span id="latest-release-pubdate-text"></span></time></small>
    </a>
    </p>
    <p><a class="button" href="https://github.com/cylc/cylc">Clone cylc on GitHub</a></p>
    <p>
    <div id="milestone-container" style="padding-bottom:20px; margin-bottom:40px">
        <div style="float:left; width:75%">
            <a id="milestone-url" href="/milestones">
                <span id="milestone-version">retrieving repository data...</span>
            </a>
            <div id="progress-bar">
                <span id="progress-bar-inner"></span>
            </div>
        </div>
        <div id="progress">0%</div>
    </div>
    </p>

    <div id="repository-releases">retrieving repository data...</div>
</div>
 </div>
                </div>  <!--container-->
            </div>  <!--page-->
        </div>  <!--wrapper-->
<div id="footer">
            <div class="page">
                <div class="container">
                    <div class="column" style="width:25%">
                        <h4>Support</h4>
                        <ul>
                            <li><a href="https://groups.google.com/d/forum/cylc">Forum</a></li>
                            <li><a href="https://github.com/cylc/cylc/issues">Issues</a></li>
                        </ul>
                    </div>  <!--column-->
                    <div class="column" style="width:25%">
                        <h4>About</h4>
                        <ul>
                            <li><a href="users.html">Users</a></li>
                            <li><a href="license.html">License</a></li>
                        </ul>
                    </div>  <!--column-->
                    <div class="column" style="width:25%">
                        <h4>Development</h4>
                        <ul>
                            <li><a href="https://github.com/cylc/cylc">Repository</a></li>
                            <li> <a href="/blob/master/CHANGES.md">Changes</a>
 
                        </ul>
                    </div>  <!--column-->
                    <div class="column" style="width:25%">
                        <a href="index.html" id="logo_bot">
                            <span style="color:#ff5966">c</span>
                            <span style="color:#eebb00">y</span>
                            <span style="color:#00c798">l</span>
                            <span style="color:#00b4fd">c</span>
                        </a>
                    </div>  <!--column-->
                </div>  <!--container-->
            </div>  <!--page-->
        </div>  <!--footer-->

	</body>
</html>
